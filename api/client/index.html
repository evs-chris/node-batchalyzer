<!DOCTYPE html>
<html>
  <head>
    <title>batchalyzer</title>
    <script src="//cdn.ractivejs.org/edge/ractive.js"></script>
    <script src="/js/xhr-as-promised.js"></script>
    <script src="/js/config.js"></script>
    <style>
      div.list > div > div {
        display: inline-block;
      }

      div.list > div > div.list {
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="main"></div>
    <script id="tpl" type="text/html">
      <button on-click="refresh()">Refresh</button>
      <h2>Messages</h2>
      <div class="messages list">
        {{#each messages}}
          <div class="message">
            <div>{{.message}}</div>
          </div>
        {{/each}}
      </div>

      <h2>Agents</h2>
      <div class="agents list">
        {{#each agents}}
          <div class="agent {{#if .status === -1}}disabled{{elseif .status === 0}}offline{{elseif .status === 1}}online{{elseif .status === 2}}stale{{/if}}">
            <div>{{.name}}</div>
            <div>{{#if .status === -1}}Disabled{{elseif .status === 0}}Offline{{elseif .status === 1}}Online{{elseif .status === 2}}Stale{{/if}}</div>
          </div>
        {{/each}}
      </div>

      <h2>Resources</h2>
      <div class="resources list">
        {{#each resources}}
          <div class="resource">
            <div>{{.name}}</div>
          </div>
        {{/each}}
      </div>

      <h2>Schedules</h2>
      <div class="schedules list">
        {{#each schedules}}
          <div class="schedule">
            <div>{{~/filter.dateString(.target)}}</div>
            <div class="sub list jobs">
              {{#each .jobs}}
                <div class="job {{#if .status === -2}}schedule{{elseif .status === -1}}resource{{elseif .status === 0}}done{{elseif .status === 1}}failed{{elseif .status === 2}}warn{{else}}unknown{{/if}}">
                  <div>{{.id}}</div>
                  <div>{{.entry.config.name || (.entry.job || {}).name || .config.cmd}}</div>
                </div>
              {{/each}}
            </div>
          </div>
        {{/each}}
      </div>
    </script>
    <script type="text/javascript" src="/js/index.js"> </script>
  </body>
</html>
